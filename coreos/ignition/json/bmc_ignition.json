{
	"ignition": {
		"config": {},
		"security": {
			"tls": {}
		},
		"timeouts": {},
		"version": "2.2.0"
	},
	"networkd": {},
	"passwd": {},
	"storage": {
		"files": [
			{
				"filesystem": "root",
				"group": {
					"id": 500
				},
				"path": "/var/lib/bmc/bmc_coreos.sh",
				"user": {
					"id": 10
				},
				"contents": {
					"source": "data:,%23!%2Fusr%2Fbin%2Fbash%0Aset%20-e%0Alogger%20%22bmc_metadata%20starting%22%0ACONFIG_MOUNT%3D%22%2Fmedia%2Fconfigdrive%22%0ACONFIG_DRIVE%3D%22%24CONFIG_MOUNT%2Fopenstack%2Flatest%22%0Amask2cdr%20()%0A%7B%0Alocal%20x%3D%24%7B1%23%23*255.%7D%0Aset%20--%200%5E%5E%5E128%5E192%5E224%5E240%5E248%5E252%5E254%5E%20%24((%20(%24%7B%231%7D%20-%20%24%7B%23x%7D)*2%20))%20%24%7Bx%25%25.*%7D%0Ax%3D%24%7B1%25%25%243*%7D%0Aecho%20%22%2F%24((%20%242%20%2B%20(%24%7B%23x%7D%2F4)%20))%22%0A%7D%0Amkdir%20-p%20%2Frun%2Fmetadata%2F%0Arm%20%2Frun%2Fmetadata%2Fbmc%20%3E%20%2Fdev%2Fnull%202%3E%261%20%7C%7C%20true%0Aif%20!%20mountpoint%20-q%20%24CONFIG_MOUNT%3B%20then%0A%20%20%20%20logger%20%22bmc_metadata%20could%20not%20find%20mounted%20configdrive%2C%20attempting%20to%20mount%22%0A%20%20%20%20mkdir%20-p%20%24CONFIG_MOUNT%0A%20%20%20%20mount%20-o%20ro%20-L%20config-2%20%24CONFIG_MOUNT%0Afi%0Aif%20%5B%5B%20%24(systemd-detect-virt)%20%3D%20%22kvm%22%20%5D%5D%3B%20then%0A%20%20%20%20logger%20%22bmc_metadata%20Virtual%20Cloud%20Instance%20Detected%22%0A%20%20%20%20for%20NETWORK%20in%20%24(jq%20.networks%5B%5D.id%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20CLEAN_NETWORK%3D%24(echo%20%24NETWORK%20%7C%20sed%20s%2F%5C%22%2F%2Fg)%0A%20%20%20%20%20%20%20%20%20%20%20%20UNIT_FILE%3D%22%2Fetc%2Fsystemd%2Fnetwork%2F%22%24CLEAN_NETWORK%22_unit.network%22%0A%20%20%20%20%20%20%20%20%20%20%20%20LINK%3D%24(jq%20-r%20'.networks%5B%5D%20%7C%20select(.id%20%3D%3D%20'%24NETWORK')%20%7C%20.link'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20IP%3D%24(jq%20-r%20'.networks%5B%5D%20%7C%20select(.id%20%3D%3D%20'%24NETWORK')%20%7C%20.ip_address'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20NETMASK%3D%24(jq%20-r%20'.networks%5B%5D%20%7C%20select(.id%20%3D%3D%20'%24NETWORK')%20%7C%20.netmask'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20CIDR%3D%24(mask2cdr%20%22%24NETMASK%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20GATEWAY%3D%24(jq%20-r%20'.networks%5B%5D%20%7C%20select(.id%20%3D%3D%20'%24NETWORK')%20%7C%20.routes%5B%5D.gateway'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20DNS0%3D%24(jq%20-r%20'.services%5B0%5D%20%7C%20select(.type%20%3D%3D%20%22dns%22)%20%7C%20.address'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20DNS1%3D%24(jq%20-r%20'.services%5B1%5D%20%7C%20select(.type%20%3D%3D%20%22dns%22)%20%7C%20.address'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BMatch%5D%22%20%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Name%3D%24LINK%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BNetwork%5D%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Address%3D%24IP%24CIDR%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20!%20-z%20%22%24GATEWAY%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Gateway%3D%24GATEWAY%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22DNS%3D%24DNS0%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22DNS%3D%24DNS1%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22BMC_%22%24CLEAN_NETWORK%22_IP%3D%22%24IP%22%22%20%3E%3E%20%2Frun%2Fmetadata%2Fbmc%0A%20%20%20%20%20%20%20%20done%0Aelse%0A%20%20%20%20logger%20%22bmc_metadata%20Bare%20Metal%20Cloud%20Instance%20Detected%22%0A%20%20%20%20OS_NICS%3D%24(jq%20-r%20'.links%5B%5D%20%7C%20select(.type%20%3D%3D%20%22ethernet%22)%20%7C%20.ethernet_mac_address'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20REAL_NICS%3D%24(lshw%20-class%20network%202%3E%20%2Fdev%2Fnull%20%7C%20grep%20-A6%20%22-network%20%22%20%7C%20grep%20logical%20%7C%20awk%20'%7Bprint%24NF%7D')%0A%20%20%20%20BONDS%3D%24(jq%20-r%20'.links%5B%5D%20%7C%20select(.type%20%3D%3D%20%22bond%22)%20%7C%20.id'%20%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20mkdir%20-p%20%2Fetc%2Fmodprobe.d%2F%0A%20%20%20%20echo%20%22options%20bonding%20miimon%3D5%22%20%3E%20%2Fetc%2Fmodprobe.d%2Fbonding.conf%0A%20%20%20%20echo%20%22options%20bonding%20lacp_rate%3D1%22%20%3E%3E%20%2Fetc%2Fmodprobe.d%2Fbonding.conf%0A%20%20%20%20echo%20%22options%20bonding%20mode%3D802.3ad%22%20%3E%3E%20%2Fetc%2Fmodprobe.d%2Fbonding.conf%0A%20%20%20%20echo%20%22options%20xmit_hash_policy%3Dlayer3%2B4%22%20%3E%3E%20%2Fetc%2Fmodprobe.d%2Fbonding.conf%0A%20%20%20%20declare%20-A%20NICS_TO_BOND%0A%20%20%20%20for%20REAL_NIC%20in%20%24REAL_NICS%0A%20%20%20%20%20%20%20%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20OS_NIC%20in%20%24OS_NICS%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%5B%20%24(ethtool%20-P%20%24REAL_NIC%20%7C%20awk%20'%7Bprint%24NF%7D')%20%3D%3D%20%24OS_NIC%20%5D%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20OS_NIC_NAME%3D%24(jq%20-r%20--arg%20OS_NIC%20%24OS_NIC%20'.links%5B%5D%20%7C%20select((.ethernet_mac_address%20%3D%3D%20%24OS_NIC)%20and%20.type%20%3D%3D%20%22ethernet%22)%20%7C%20.id'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20OS_NIC_BOND%3D%24(jq%20-r%20--arg%20OS_NIC_NAME%20%24OS_NIC_NAME%20'.links%5B%5D%20%7C%20select(.type%20%3D%3D%20%22bond%22)%20%7C%20select(.bond_links%5B%5D%20%7C%20contains(%24OS_NIC_NAME))%20%7C%20.id'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20NICS_TO_BOND%5B%24REAL_NIC%5D%3D%24OS_NIC_BOND%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20UNIT_FILE%3D%22%2Fetc%2Fsystemd%2Fnetwork%2F%24REAL_NIC.network%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BMatch%5D%22%20%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Name%3D%24REAL_NIC%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BNetwork%5D%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Bond%3D%24OS_NIC_BOND%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20done%0A%20%20%20%20%20%20%20%20done%0A%20%20%20%20for%20BOND%20in%20%24BONDS%0A%20%20%20%20%20%20%20%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20BOND_MODE%3D%24(jq%20-r%20--arg%20BOND%20%24BOND%20'.links%5B%5D%20%7C%20select(.id%20%3D%3D%20%24BOND)%20%7C%20.bond_mode'%20%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20BOND_XMIT_HASH_POL%3D%24(jq%20-r%20--arg%20BOND%20%24BOND%20'.links%5B%5D%20%7C%20select(.id%20%3D%3D%20%24BOND)%20%7C%20.bond_xmit_hash_policy'%20%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20BOND_MIIMON%3D%24(jq%20-r%20--arg%20BOND%20%24BOND%20'.links%5B%5D%20%7C%20select(.id%20%3D%3D%20%24BOND)%20%7C%20.bond_miimon'%20%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20BOND_VLANS%3D%24(jq%20-r%20--arg%20BOND%20%24BOND%20'.links%5B%5D%20%7C%20select(.vlan_link%20%3D%3D%20%24BOND)%20%7C%20.id'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20UNIT_FILE%3D%22%2Fetc%2Fsystemd%2Fnetwork%2F%24BOND.netdev%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BNetDev%5D%22%20%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Name%3D%24BOND%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Kind%3Dbond%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BBond%5D%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Mode%3D%24BOND_MODE%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22TransmitHashPolicy%3D%24BOND_XMIT_HASH_POL%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22MIIMonitorSec%3D5%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22LACPTransmitRate%3Dfast%22%20%3E%3E%20%22%24UNIT_FILE%22%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20UNIT_FILE%3D%22%2Fetc%2Fsystemd%2Fnetwork%2F%24BOND.network%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BMatch%5D%22%20%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Name%3D%24BOND%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BNetwork%5D%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20BOND_VLAN%20in%20%24BOND_VLANS%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22VLAN%3D%24BOND_VLAN%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20done%0A%20%20%20%20%20%20%20%20%20%20%20%20NICS_IN_BOND%3D%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20NIC%20in%20%22%24%7B!NICS_TO_BOND%5B%40%5D%7D%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20%24%7BNICS_TO_BOND%5B%24NIC%5D%7D%20%3D%3D%20%24BOND%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20NICS_IN_BOND%3D%22%24%7BNICS_IN_BOND%7D%20%24NIC%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20done%0A%20%20%20%20%20%20%20%20%20%20%20%20NICS_IN_BOND%3D%24(echo%20%24NICS_IN_BOND%20%7C%20sed%20's%2F%5E%20*%2F%2Fg')%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22BindCarrier%3D%24NICS_IN_BOND%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20done%0A%20%20%20%20for%20VLAN%20in%20%24(jq%20-r%20'.networks%5B%5D%20%7C%20select(.link%20%7C%20contains(%22vlan%22))%20%7C%20.link'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20VLAN_ID%3D%24(jq%20-r%20--arg%20VLAN%20%24VLAN%20'.links%5B%5D%20%7C%20select(.id%20%3D%3D%20%24VLAN)%20%7C%20.vlan_id'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20VLAN_MAC%3D%24(jq%20-r%20--arg%20VLAN%20%24VLAN%20'.links%5B%5D%20%7C%20select(.id%20%3D%3D%20%24VLAN)%20%7C%20.ethernet_mac_address'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20UNIT_FILE%3D%22%2Fetc%2Fsystemd%2Fnetwork%2F%24VLAN.netdev%22%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BNetDev%5D%22%20%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Name%3D%24VLAN%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Kind%3Dvlan%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22MACAddress%3D%24VLAN_MAC%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BVLAN%5D%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Id%3D%24VLAN_ID%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20done%0A%20%20%20%20for%20NETWORK%20in%20%24(jq%20-r%20'.networks%5B%5D%20%7C%20select(.link%20%7C%20contains(%22vlan%22))%20%7C%20.link'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20IP%3D%24(jq%20-r%20--arg%20NETWORK%20%24NETWORK%20'.networks%5B%5D%20%7C%20select(.link%20%3D%3D%20%24NETWORK)%20%7C%20.ip_address'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20NETMASK%3D%24(jq%20-r%20--arg%20NETWORK%20%24NETWORK%20'.networks%5B%5D%20%7C%20select(.link%20%3D%3D%20%24NETWORK)%20%7C%20.netmask'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20CIDR%3D%24(mask2cdr%20%22%24NETMASK%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20GATEWAY%3D%24(jq%20-r%20--arg%20NETWORK%20%24NETWORK%20'.networks%5B%5D%20%7C%20select(.link%20%3D%3D%20%24NETWORK)%20%7C%20.routes%5B%5D.gateway'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20DNS0%3D%24(jq%20-r%20'.services%5B0%5D%20%7C%20select(.type%20%3D%3D%20%22dns%22)%20%7C%20.address'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20DNS1%3D%24(jq%20-r%20'.services%5B1%5D%20%7C%20select(.type%20%3D%3D%20%22dns%22)%20%7C%20.address'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20UNIT_FILE%3D%22%2Fetc%2Fsystemd%2Fnetwork%2F%24NETWORK.network%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BMatch%5D%22%20%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Name%3D%24NETWORK%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BAddress%5D%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Address%3D%24IP%24CIDR%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%5B%20!%20-z%20%22%24GATEWAY%22%20%5D%3B%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BRoute%5D%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Destination%3D0.0.0.0%2F0%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22Gateway%3D%24GATEWAY%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22%5BNetwork%5D%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22DNS%3D%24DNS0%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22DNS%3D%24DNS1%22%20%3E%3E%20%22%24UNIT_FILE%22%0A%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20%20%20NETWORK_NAME%3D%24(jq%20-r%20--arg%20NETWORK%20%24NETWORK%20'.networks%5B%5D%20%7C%20select(.link%20%7C%20contains(%24NETWORK))%20%7C%20.id'%20%3C%20%24CONFIG_DRIVE%2Fnetwork_data.json)%0A%20%20%20%20%20%20%20%20%20%20%20%20echo%20%22BMC_%22%24NETWORK%22_NAME_IP%3D%24IP%22%20%3E%3E%20%2Frun%2Fmetadata%2Fbmc%0A%20%20%20%20done%0Afi%0Alogger%20%22bmc_metadata%20systemd-networkd%20configuration%20done%22%0ABMC_INSTANCE_HOSTNAME%3D%24(jq%20-r%20.name%20%24CONFIG_DRIVE%2Fmeta_data.json)%0ABMC_CORE_PASSWD%3D%24(jq%20-r%20.admin_pass%20%3C%20%24CONFIG_DRIVE%2Fmeta_data.json)%0Ahostnamectl%20set-hostname%20%22%24BMC_INSTANCE_HOSTNAME%22%0Alogger%20%22bmc_metadata%20BMC%20instance%20hostname%20set%22%0Aecho%20-e%20%22%24BMC_CORE_PASSWD%5Cn%24BMC_CORE_PASSWD%22%20%7C%20passwd%20core%20%3E%20%2Fdev%2Fnull%202%3E%261%0Ajq%20-r%20.public_keys%5B%5D%20%3C%20%24CONFIG_DRIVE%2Fmeta_data.json%20%3E%20%2Fhome%2Fcore%2F.ssh%2Fauthorized_keys%0Achown%20core%3Acore%20%2Fhome%2Fcore%2F.ssh%2Fauthorized_keys%0Achmod%200644%20%2Fhome%2Fcore%2F.ssh%2Fauthorized_keys%0Alogger%20%22bmc_metadata%20Instance%20user%20%22core%22%20password%20set%20and%20public%20ssh%20key%20added%22%0Aumount%20%24CONFIG_MOUNT%20%3E%20%2Fdev%2Fnull%202%3E%261%20%7C%7C%20true%0Alogger%20%22bmc_metadata%20complete%22%0A",
					"verification": {}
				},
				"mode": 493
			}
		]
	},
	"systemd": {
		"units": [
			{
				"dropins": [
					{
						"contents": "[Unit]\nRequires=bmc_metadata.service\nAfter=bmc_metadata.service\n\n[Service]\nEnvironmentFile=/run/metadata/bmc\nExecStart=\nExecStart=/usr/lib/coreos/etcd-wrapper $ETCD_OPTS \\\n  --listen-peer-urls=\"http://${BMC_network1_IP}:2380\" \\\n  --listen-client-urls=\"http://0.0.0.0:2379\" \\\n  --initial-advertise-peer-urls=\"http://${BMC_network1_IP}:2380\" \\\n  --advertise-client-urls=\"http://${BMC_network1_IP}:2379\" \\\n  --discovery=\"https://discovery.etcd.io/<token>\"",
						"name": "20-clct-etcd-member.conf"
					}
				],
				"enable": true,
				"name": "etcd-member.service"
			},
			{
				"dropins": [
					{
						"contents": "[Unit]\nConditionVirtualization=|none",
						"name": "10-configdrive-bmc.conf"
					}
				],
				"enabled": true,
				"name": "media-configdrive.mount"
			},
			{
				"contents": "[Unit]\nDescription=Metadata population for INAP BMC\nBefore=systemd-networkd.service\n[Service]\nType=oneshot\nRemainAfterExit=yes\nTimeoutStartSec=60\nExecStart=/usr/bin/bash -c \"/var/lib/bmc/bmc_coreos.sh\"\n[Install]\nWantedBy=systemd-networkd.service\n",
				"enabled": true,
				"name": "bmc_metadata.service"
			}
		]
	}
}